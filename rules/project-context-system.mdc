---
description: Autonomous context management - stores discoveries, captures knowledge, manages global rules
alwaysApply: true
---

# Cursor Context System

You MUST follow these rules to help future sessions. This is not optional.

---

## CRITICAL: Creating New Global Rules

**STOP! Before creating ANY file in `~/.cursor/rules/`:**

```bash
# 1. Find cursor-config repo
CURSOR_CONFIG=$(cat ~/.cursor/cursor-config-location 2>/dev/null)

# 2. If it exists, create rule THERE (not in ~/.cursor/rules/)
if [ -n "$CURSOR_CONFIG" ]; then
    cat > "$CURSOR_CONFIG/rules/<rule-name>.mdc" << 'EOF'
---
description: <description>
alwaysApply: true
---
<content>
EOF
    cd "$CURSOR_CONFIG" && ./setup.sh && git add -A && git commit -m "Add <rule-name>" && git push
fi
```

**Exception:** Project-specific private rules (e.g., Fever) → create directly in `~/.cursor/rules/`

---

## On Session Start

Silently check for existing context:
```bash
git config --get-regexp "^project\." 2>/dev/null
ls .git/local-context/ .git/local-context/flows/ 2>/dev/null
```

**Before exploring code**, check if documentation exists for the topic.

---

## What to Store & Where

### Layer 1: Git Config (simple facts)
```bash
git config --local project.test-cmd "pytest -v"
git config --local project.architecture "hexagonal"
```

| Key | When |
|-----|------|
| `project.test-cmd` | Found working test command |
| `project.dev-cmd` | Found dev server command |
| `project.architecture` | Identified pattern |
| `project.framework` | Identified framework |

### Layer 2: Local Context Files (detailed knowledge)

**Location:** `.git/local-context/`

| File | Content |
|------|---------|
| `flows/<name>.md` | End-to-end feature documentation |
| `glossary.md` | Domain terminology |
| `entry-points.md` | Where to start for tasks |
| `qa.md` | Answered questions |
| `code-map.md` | Codebase structure |

### Layer 3: Local Cursor Rules (behavior corrections)

**Location:** `.cursor/rules/local-*.mdc` (git-ignored)

Create when user corrects you: "Don't use X, use Y"

---

## Knowledge Capture Triggers

**Document when you:**
- Read >5 files to understand something
- Trace a flow through multiple layers
- Figure out a business process
- Learn domain terminology

### Flow Document Template

```bash
mkdir -p .git/local-context/flows
cat > .git/local-context/flows/<feature>.md << 'EOF'
# <Feature> Flow

## Summary
<1-2 sentences>

## Entry Points
- API: `path/to/file.py` → `function()`

## Key Files
| File | Purpose |
|------|---------|
| `path/to/file.py` | <what it does> |

## Flow Sequence
1. <Step 1>
2. <Step 2>

## Gotchas
- <non-obvious behavior>
EOF
```

After documenting, say: "I've documented [feature] for future sessions."

---

## Detecting Outdated Information

**Update when:**
- Stored command fails → find working one, update
- Path doesn't exist → find new path, update
- User says "that's old" → update immediately

Say: "Updated - [what changed]."

---

## Autonomous Behavior Summary

1. **Check context** at session start
2. **Store discoveries** without asking (mention briefly)
3. **Update outdated info** immediately
4. **Document complex features** after understanding them
5. **Create global rules** in cursor-config repo, not ~/.cursor/rules/
